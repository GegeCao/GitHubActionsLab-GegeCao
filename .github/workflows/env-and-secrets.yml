name: Env and Secrets Demo

on:
  workflow_dispatch:

env:
  AWS_REGION: us-east-1
  ENVIRONMENT: production

jobs:
  deploy-to-aws:
    name: Deploy to AWS
    runs-on: ubuntu-latest
    env:
      DEPLOYMENT_NAME: my-app-deploy
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Print workflow-level environment variables
        run: |
          echo "Workflow-level (templated): AWS_REGION=${{ env.AWS_REGION }}, ENVIRONMENT=${{ env.ENVIRONMENT }}"
          echo "Workflow-level (shell): AWS_REGION=$AWS_REGION, ENVIRONMENT=$ENVIRONMENT"

      - name: Access and print AWS credentials from secrets (will be masked in logs)
        run: |
          echo "Reading AWS credentials from secrets (masked):"
          echo "AWS_ACCESS_KEY_ID=${{ secrets.AWS_ACCESS_KEY_ID }}"
          echo "AWS_SECRET_ACCESS_KEY=${{ secrets.AWS_SECRET_ACCESS_KEY }}"

      - name: Set a step-level environment variable and use it
        env:
          STEP_TOKEN: step-abc-123
        run: |
          echo "STEP_TOKEN (this step): $STEP_TOKEN"
          echo "DEPLOYMENT_NAME (job-level): $DEPLOYMENT_NAME"
          echo "ENVIRONMENT (workflow-level): $ENVIRONMENT"

      - name: Demonstrate variable scope in a new step
        run: |
          echo "STEP_TOKEN in this new step: ${STEP_TOKEN:-<not set>}"
          echo "DEPLOYMENT_NAME (job-level) is still available: $DEPLOYMENT_NAME"
          echo "AWS_REGION (workflow-level) is still available: $AWS_REGION"

      - name: Simulate deployment using variables
        run: |
          echo "Starting deployment '$DEPLOYMENT_NAME' to environment '$ENVIRONMENT' in region '$AWS_REGION'"
          sleep 2
          echo "Deployment (simulated) finished."
